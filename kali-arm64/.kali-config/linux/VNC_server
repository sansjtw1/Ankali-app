#!/bin/bash
# Copyright (c) 2024 SansJtw
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in all
# copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
# SOFTWARE.
#
# Email: sansjtw@163.com, sansjtw1@gmail.com

# This script menu uses the installation startup of VNC service and the installation startup of graphical desktop.

# è®©ä½ çœŸæ­£çœ‹åˆ°æˆ‘çš„æ ·å­ãƒ¾(â‰§Oâ‰¦)ã€ƒ

# å®šä¹‰é¢œè‰²
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
RESET='\033[0m'
source /.kali-config/language.conf

# æ›´æ–°ç³»ç»Ÿ
echo -e "${YELLOW}[*] Updating system...${RESET}"
apt update

# åˆ›å»ºé…ç½®æ–‡ä»¶å¤¹
mkdir -p ~/.kali-config

# æ£€æŸ¥å¹¶æ¸…ç†å†²çªçš„é”æ–‡ä»¶
if [ -f /tmp/.X1-lock ] || [ -f /tmp/.X11-unix/X1 ]; then
    echo -e "${YELLOW}[*] Removing stale X server lock files...${RESET}"
    rm -f /tmp/.X1-lock
    rm -f /tmp/.X11-unix/X1
fi

# Set log file path
LOG_DIR="/.kali-config/log"
LOG_FILE="$LOG_DIR/$(date +'%Y-%m-%d').log"

# Create log directory
mkdir -p "$LOG_DIR"

# Define log function
log() {
    echo -e "$1" >> "$LOG_FILE"
    echo -e "$2" # Display content in terminal
}

# Is VNC installed
VNCINSTALLIF(){
VNCPACKAGE="tigervnc-standalone-server"
if dpkg -l | grep -q "^ii[ ]*$VNCPACKAGE"; then
    log "[*]tigervnc-standalone-server package has been installed."
    VNCINSTALL="true"
else
    log "[*]tigervnc-standalone-server package is not installed."
    VNCINSTALL="false"
fi
}

NOVNCINSTALLIF(){
NOVNCPACKAGE="novnc"
if dpkg -l | grep -q "^ii[ ]*$NOVNCPACKAGE"; then
    log "[*]tigervnc-standalone-server package has been installed."
    NOVNCINSTALL="true"
else
    log "[*]tigervnc-standalone-server package is not installed."
    NOVNCINSTALL="false"
fi
}

# system operation
desktop_operate(){
echo "Try to uninstall Firefox."
echo "find / -type f -name "*firefox*" -exec rm -f {} \; 2>/dev/null"
find / -type f -name "*firefox*" -exec rm -f {} \; 2>/dev/null
echo "Try to install the Chromium browser."
echo "eatmydata apt install -y chromium chromium-l10n"
apt update
eatmydata apt install -y chromium chromium-l10n
echo "xdg-settings set default-web-browser chromium.desktop"
xdg-settings set default-web-browser chromium.desktop
apt remove firefox-esr -y
}

# Repair time to China Shanghai time
desktop_time_repair(){
echo "ZONE=Asia/Shanghai" >> /etc/sysconfig/clock
rm -f /etc/localtime
ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
}

#Chinese menu
menu_cn(){
vnc-installation(){
if [ -e ~/.vnc/passwd ]; then
IFVNCPASSWD="å·²è®¾ç½®"
else
IFVNCPASSWD="æœªè®¾ç½®"
fi
if [ -e ~/.kali-config/kali-desktop ]; then
Desktop_environment=$(cat ~/.kali-config/kali-desktop)
else
Desktop_environment="è¿˜æ²¡æœ‰æ¡Œé¢ç¯å¢ƒ"
fi

echo -e "\033[1;33m"
headers="VNC æœåŠ¡,æ˜¯å¦å®‰è£…"
rows=(
    "VNC server,$VNCINSTALL"
    "NOVNC,$VNCINSTALL"
)
python3 /.kali-config/linux/table_gen.py "$headers" "${rows[@]}"

headers="å·²å®‰è£…çš„æ¡Œé¢ç¯å¢ƒ"
rows=(
    "$Desktop_environment"
)
python3 /.kali-config/linux/table_gen.py "$headers" "${rows[@]}"

headers="VNC å¯†ç "
rows=(
    "$IFVNCPASSWD"
)
python3 /.kali-config/linux/table_gen.py "$headers" "${rows[@]}"
echo -e "\033[0m"
}
Dscription(){
echo -e """
ï¿´ï¿´ï¿´ï¿´ ï¿´ï¿´ ï¿´ï¿´ ï¿´ ï¿´ ï¿´ï¿´ï¿´ ï¿´ï¿´ï¿´ï¿´ ï¿´ï¿´ ï¿´ï¿´ï¿´ï¿´ ï¿´ï¿´ ï¿´ ï¿´ï¿´ï¿´ ï¿´ ï¿´ï¿´â–ƒ â–† â–ˆ
ğ™„ğ™ˆğ™‹ğ™Šğ™ğ™ğ™„ğ˜½ğ™‡ğ™€  ğ™„ğ™ ğ™‰ğ™Šğ™ğ™ƒğ™„ğ™‰ğ™‚
æ²¡   æœ‰   ä¸   å¯   èƒ½
\033[0;32m
âŒ: å¯èƒ½å®Œå…¨ä¸é€‚é… Ankali
â“: å¯èƒ½é€‚é… Ankaliï¼Œä½†æ˜¯æ•ˆæœä¸æ˜¯å¾ˆå¥½
âœ…: åŸºæœ¬é€‚é… Ankaliï¼Œæ˜¯å»ºè®®å®‰è£…çš„æ¡Œé¢
\033[1;33m
+----------------+-------------------------------------------------------+
| æ¡Œé¢ç¯å¢ƒ       | æè¿°å’Œæ”¯æŒ                                            |
+----------------+-------------------------------------------------------+
| GNOME      âŒ  | ä¸€ä¸ªç®€æ´ã€ç°ä»£çš„æ¡Œé¢ç¯å¢ƒã€‚ä½†æ˜¯Ankaliå¯èƒ½ä¸æ”¯æŒ        |
| KDE Plasma â“  | åŠŸèƒ½ä¸°å¯Œï¼Œé«˜åº¦å¯å®šåˆ¶çš„æ¡Œé¢ç¯å¢ƒã€‚Ankaliå¯èƒ½å‹‰å¼ºèƒ½ç”¨    |
| XFCE       âœ…  | è½»é‡çº§æ¡Œé¢ç¯å¢ƒï¼Œæ³¨é‡æ€§èƒ½å’Œèµ„æºæ•ˆç‡ã€‚Ankaliå·²ç»å®Œç¾é€‚é…|
| MATE       âœ…  | GNOME 2çš„åˆ†æ”¯ï¼Œæä¾›ä¼ ç»Ÿæ¡Œé¢ä½“éªŒã€‚                     |
| LXDE       âœ…  | æå…¶è½»é‡çº§çš„æ¡Œé¢ç¯å¢ƒï¼Œé€‚åˆè€æ—§æˆ–ä½é…ç½®çš„è®¡ç®—æœºã€‚      |
| E17        âœ…  | é«˜åº¦çš„å¯å®šåˆ¶æ€§ã€ç°ä»£çš„è§†è§‰æ•ˆæœå’Œå¯¹èµ„æºçš„é«˜æ•ˆåˆ©ç”¨      |
| I3WM       âŒ  | æœ‰ç€å…¶ç®€æ´ã€è½»é‡çº§å’Œå¯¹é”®ç›˜å¿«æ·é”®çš„é‡è§†                |
+----------------+-------------------------------------------------------+

+------------+------------------+
|  æ¡Œé¢ç¯å¢ƒ  | çº¦æ‰€éœ€çš„å ç”¨ç©ºé—´ |
+------------+------------------+
| GNOME      |     2,800 MB     |
| KDE Plasma |     4,000 MB     |
| XFCE       |     2,300 MB     |
| MATE       |     2,600 MB     |
| LXDE       |     2,300 MB     |
| E17        |     1,900 MB     |
| I3WM       |     1,900 MB     |
+------------+------------------+
\033[0m
"""
}

IFVNCINSTALL(){
VNCINSTALLIF
if [ "$VNCINSTALL" = "true" ]; then
    VNCINSTALL="å·²å®‰è£…"
elif [ "$VNCINSTALL" = "false" ]; then
    VNCINSTALL="æœªå®‰è£…"
else
    VNCINSTALL="æœªçŸ¥"
fi
}
IFNOVNCINSTALL(){
NOVNCINSTALLIF
if [ "$NOVNCINSTALL" = "true" ]; then
    NOVNCINSTALL="å·²å®‰è£…"
elif [ "$NOVNCINSTALL" = "false" ]; then
    NOVNCINSTALL="æœªå®‰è£…"
else
    NOVNCINSTALL="æœªçŸ¥"
fi
}
source /.kali-config/language.conf
while true; do
    log "[INFO] æ˜¾ç¤ºä¸»èœå•" "${CYAN}è¯·é€‰æ‹©ä¸€ä¸ªé€‰é¡¹:${RESET}"
    echo -e "${GREEN}[1]${RESET} ${BLUE}å®‰è£… GUI å›¾å½¢æ¡Œé¢${RESET}"
    echo -e "${GREEN}[2]${RESET} ${BLUE}å¸è½½ GUI å›¾å½¢æ¡Œé¢${RESET}"
    echo -e "${GREEN}[3]${RESET} ${BLUE}VNC æœåŠ¡${RESET}"
    echo -e "${GREEN}[4]${RESET} ${BLUE}é€€å‡º${RESET}"
    read -p "è¯·è¾“å…¥ä½ çš„é€‰æ‹©: " choice

    if [[ $choice -eq 1 ]]; then
        # GUI å›¾å½¢æ¡Œé¢èœå•
        while true; do
            Dscription
            log "[INFO] æ˜¾ç¤º GUI å›¾å½¢æ¡Œé¢èœå•" "${CYAN}é€‰æ‹©ä¸€ä¸ªå›¾å½¢æ¡Œé¢ç¯å¢ƒå®‰è£…:${RESET}"
            echo -e "${GREEN}[1]${RESET} GNOME"
            echo -e "${GREEN}[2]${RESET} KDE Plasma"
            echo -e "${GREEN}[3]${RESET} XFCE"
            echo -e "${GREEN}[4]${RESET} MATE"
            echo -e "${GREEN}[5]${RESET} LXDE"
            echo -e "${GREEN}[6]${RESET} E17 (Enlightenment)"
            echo -e "${GREEN}[7]${RESET} I3WM"
            echo -e "${GREEN}[0]${RESET} é€€å‡º"
            read -p "è¯·è¾“å…¥ä½ çš„é€‰æ‹©: " gui_choice

            case $gui_choice in
                1)
                    log "[INFO] å®‰è£… GNOME" "${YELLOW}[+] æ­£åœ¨å®‰è£… GNOME...${RESET}"
                    apt install -y kali-desktop-gnome
                    desktop_operate
                    desktop_time_repair
                    echo "kali-desktop-gnome" >> ~/.kali-config/kali-desktop
                    break
                    ;;
                2)
                    log "[INFO] å®‰è£… KDE Plasma" "${YELLOW}[+] æ­£åœ¨å®‰è£… KDE Plasma...${RESET}"
                    apt install -y kali-desktop-kde
                    desktop_operate
                    desktop_time_repair
                    echo "kali-desktop-kde" >> ~/.kali-config/kali-desktop
                    break
                    ;;
                3)
                    log "[INFO] å®‰è£… XFCE" "${YELLOW}[+] æ­£åœ¨å®‰è£… XFCE...${RESET}"
                    apt install -y kali-desktop-xfce
                    desktop_operate
                    desktop_time_repair
                    echo "kali-desktop-xfce" >> ~/.kali-config/kali-desktop
                    break
                    ;;
                4)
                    log "[INFO] å®‰è£… MATE" "${YELLOW}[+] æ­£åœ¨å®‰è£… MATE...${RESET}"
                    apt install -y kali-desktop-mate
                    desktop_operate
                    desktop_time_repair
                    echo "kali-desktop-mate" >> ~/.kali-config/kali-desktop
                    break
                    ;;
                5)
                    log "[INFO] å®‰è£… LXDE" "${YELLOW}[+] æ­£åœ¨å®‰è£… LXDE...${RESET}"
                    apt install -y kali-desktop-lxde
                    desktop_operate
                    desktop_time_repair
                    echo "kali-desktop-lxde" >> ~/.kali-config/kali-desktop
                    break
                    ;;
                6)
                    log "[INFO] å®‰è£… E17" "${YELLOW}[+] æ­£åœ¨å®‰è£… E17...${RESET}"
                    apt install -y kali-desktop-e17
                    desktop_operate
                    desktop_time_repair
                    echo "kali-desktop-e17" >> ~/.kali-config/kali-desktop
                    break
                    ;;
                7)
                    log "[INFO] å®‰è£… i3wm" "${YELLOW}[+] æ­£åœ¨å®‰è£… i3wm...${RESET}"
                    apt install -y kali-desktop-i3
                    desktop_operate
                    desktop_time_repair
                    echo "kali-desktop-i3" >> ~/.kali-config/kali-desktop
                    break
                    ;;
                0)
                    exit 1
                    ;;
                *)
                    log "[WARNING] æ— æ•ˆé€‰æ‹©" "${RED}[!] æ— æ•ˆçš„é€‰æ‹©ï¼Œè¯·é‡è¯•ã€‚${RESET}"
                    ;;
            esac
        done
        break
    elif [[ $choice -eq 2 ]]; then
    /.kali-config/linux/undesktop
    break
    elif [[ $choice -eq 3 ]]; then
        # VNC æœåŠ¡èœå•
        while true; do
            IFVNCINSTALL
            IFNOVNCINSTALL
            vnc-installation
            log "[INFO] æ˜¾ç¤º VNC æœåŠ¡èœå•" "${CYAN}é€‰æ‹©ä¸€ä¸ªVNCæœåŠ¡é€‰é¡¹:${RESET}"
            echo -e "${GREEN}[1]${RESET} å®‰è£… VNC æœåŠ¡: $VNCINSTALL"
            echo -e "${GREEN}[2]${RESET} å®‰è£… NOVNC æœåŠ¡: $NOVNCINSTALL"
            echo -e "${GREEN}[3]${RESET} é…ç½® VNC å¯†ç "
            echo -e "${GREEN}[4]${RESET} ç›´æ¥å¯åŠ¨æ¡Œé¢ä¸ VNC æœåŠ¡"
            echo -e "${GREEN}[5]${RESET} å¯åŠ¨ VNC + NOVNC æœåŠ¡"
            echo -e "${GREEN}[0]${RESET} é€€å‡º"
            read -p "è¯·è¾“å…¥ä½ çš„é€‰æ‹©: " vnc_choice

            case $vnc_choice in
                1)
                    log "[INFO] å®‰è£… VNC æœåŠ¡" "${YELLOW}[+] æ­£åœ¨å®‰è£…VNCæœåŠ¡...${RESET}"
                    apt install -y tigervnc-standalone-server xinit
                    IFVNCINSTALL
                    ;;
                2)
                    sudo apt update && sudo apt upgrade -y
                    sudo apt install novnc websockify -y
                    IFNOVNCINSTALL
                    ;;
                3)
                    log "[INFO] é…ç½® VNC å¯†ç " "${YELLOW}[+] æ­£åœ¨é…ç½®VNCå¯†ç ...${RESET}"
                    vncpasswd
                    ;;
                4)
                    if [ "$VNCINSTALL" = "æœªå®‰è£…" ]; then
                    log "[INFO]ä½ è¿˜æœªå®‰è£… VNC æœåŠ¡ï¼Œä½ å¯ä»¥å®‰è£…ä»–" "${RED}[!] ä½ è¿˜æœªå®‰è£… VNC æœåŠ¡ï¼Œä½ å¯ä»¥å®‰è£…å®ƒ"
                    else
                    if [ -e ~/.vnc/passwd ]; then
                    log "The password has been set correctly. Continue to run the desktop."
                    else
                    log "[INFO] å¼€å§‹é…ç½® VNC å¯†ç " "${YELLOW}[+] æ‚¨è¿˜æœªé…ç½® VNC å¯†ç ï¼Œæ‚¨éœ€è¦é…ç½® VNC å¯†ç ...${RESET}"
                    vncpasswd
                    fi
                    # æ£€æŸ¥å·²å®‰è£…çš„æ¡Œé¢ç¯å¢ƒ
                    if [ -f ~/.kali-config/kali-desktop ]; then
                        desktops=($(cat ~/.kali-config/kali-desktop))
                        if [ ${#desktops[@]} -gt 1 ]; then
                            log "[INFO] æ‰¾åˆ°å¤šä¸ªæ¡Œé¢ç¯å¢ƒ" "${CYAN}æ‰¾åˆ°å¤šä¸ªæ¡Œé¢ï¼Œè¯·é€‰æ‹©ä¸€ä¸ªå¼€å§‹${RESET}"
                            for i in "${!desktops[@]}"; do
                                echo -e "${GREEN}[$((i+1))]${RESET} ${desktops[$i]}"
                            done
                            read -p "è¯·è¾“å…¥ä½ çš„é€‰æ‹©: " desktop_choice
                            selected_desktop=${desktops[$((desktop_choice-1))]}
                        else
                            selected_desktop=${desktops[0]}
                        fi
                        log "[INFO] å¯åŠ¨ VNC æœåŠ¡" "${YELLOW}[+] æ­£åœ¨ä½¿ç”¨ ${selected_desktop} å¯åŠ¨ VNC æœåŠ¡...${RESET}"

                        # å¯åŠ¨é€‰å®šçš„æ¡Œé¢ç¯å¢ƒ
                        case $selected_desktop in
                            "kali-desktop-gnome")
                                startx &
                                ;;
                            "kali-desktop-kde")
                                startplasma-x11 &
                                ;;
                            "kali-desktop-xfce")
                                startxfce4 &
                                ;;
                            "kali-desktop-mate")
                                mate-session &
                                ;;
                            "kali-desktop-lxde")
                                startlxde &
                                ;;
                            "kali-desktop-e17")
                                enlightenment_start &
                                ;;
                            "kali-desktop-i3")
                                i3 &
                                ;;
                            *)
                                log "[ERROR] æœªè¯†åˆ«çš„æ¡Œé¢ç¯å¢ƒ" "${RED}[!] æœªè¯†åˆ«çš„æ¡Œé¢ç¯å¢ƒï¼Œå°è¯•æ‰‹åŠ¨å¯åŠ¨ã€‚${RESET}"
                                ;;
                        esac

                        # å¯åŠ¨VNCæœåŠ¡å™¨å¹¶è·å–è¾“å‡º
                        output=$(vncserver 2>&1)
                        echo "VNC server output:"
                        echo "$output"

                        # æå–æ˜¾ç¤ºç¼–å· (ä¾‹å¦‚ :1)
                        display_number=$(echo "$output" | grep -oP "(?<=:)[0-9]+" | head -n 1)

                        # æ£€æŸ¥æ˜¯å¦æˆåŠŸè·å–æ˜¾ç¤ºç¼–å·å¹¶è®¡ç®—ç«¯å£
                        if [ -n "$display_number" ]; then
                            vnc_port=$((5900 + display_number))
                            echo "VNC æœåŠ¡å™¨å·²è¿è¡Œè‡³: $vnc_port"
                            log "[SUCCESS] æˆåŠŸå¯åŠ¨ VNC æœåŠ¡å™¨" "${GREEN}[+] VNC æœåŠ¡å™¨æˆåŠŸå¯åŠ¨åœ¨ç«¯å£: $vnc_port${RESET}"
                            echo -e "${YELLOW}ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ä»¥ä¸‹åœ°å€è¿æ¥VNCæœåŠ¡å™¨:"
                            echo "127.0.0.1:$vnc_port"
                            echo "localhost:$vnc_port"
                            echo "0.0.0.0:$vnc_port"
                            echo
                            echo -e "${YELLOW}ä½ è¿˜å¯ä»¥å°è¯•ä»¥ä¸‹åœ°å€å»è¿æ¥ä½ çš„VNCæœåŠ¡å™¨:"
                            ip_addresses=$(hostname -I)
                            for ip in $ip_addresses; do
                            echo "$ip:$vnc_port"
                            done
                        else
                            echo "æ— æ³•ç¡®å®šVNCæœåŠ¡å™¨ç«¯å£å·ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹æ—¥å¿—ä¿¡æ¯"
                            log "[ERROR] å¯åŠ¨ VNC æœåŠ¡å™¨å¤±è´¥" "${RED}[!] å¯åŠ¨VNCæœåŠ¡å™¨å¤±è´¥ã€‚æ£€æŸ¥é—®é¢˜...${RESET}"

                            # æ£€æŸ¥Xorgæ—¥å¿—æ–‡ä»¶ä¸­çš„é”™è¯¯
                            if grep -q "no screens found" /var/log/Xorg.0.log; then
                                log "[ERROR] æœªæ‰¾åˆ°å±å¹•" "${RED}[!] æœªæ‰¾åˆ°å±å¹•ã€‚æ‚¨å¯èƒ½éœ€è¦å®‰è£…æˆ–é…ç½®è™šæ‹Ÿæ˜¾ç¤ºå™¨å¦‚Xvfbã€‚${RESET}"
                            fi
                            log "[INFO] æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ä»¥è·å–æ›´å¤šä¿¡æ¯" "${YELLOW}[i] æ‚¨ä¹Ÿå¯ä»¥åœ¨ /var/log/Xorg.0.log ä¸­æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚${RESET}"
                        fi

                    else
                        log "[ERROR] æœªæ‰¾åˆ°æ¡Œé¢ç¯å¢ƒ" "${RED}[!] æœªæ‰¾åˆ°æ¡Œé¢ç¯å¢ƒï¼Œè¯·å…ˆå®‰è£…ä¸€ä¸ªã€‚${RESET}"
                    fi
                    fi
                    ;;
                5)
                    if [ "$NOVNCINSTALL" = "æœªå®‰è£…" ]; then
                    log "[INFO]ä½ è¿˜æœªå®‰è£… NOVNC æœåŠ¡ï¼Œä½ å¯ä»¥å®‰è£…ä»–" "${RED}[!] ä½ è¿˜æœªå®‰è£… NOVNC æœåŠ¡ï¼Œä½ å¯ä»¥å®‰è£…å®ƒ"
                    else
                    if [ "$VNCINSTALL" = "æœªå®‰è£…" ]; then
                    log "[INFO]ä½ è¿˜æœªå®‰è£… VNC æœåŠ¡ï¼Œä½ å¯ä»¥å®‰è£…ä»–" "${RED}[!] ä½ è¿˜æœªå®‰è£… VNC æœåŠ¡ï¼Œä½ å¯ä»¥å®‰è£…å®ƒ"
                    else
                    if [ -e ~/.vnc/passwd ]; then
                    log "The password has been set correctly. Continue to run the desktop."
                    else
                    log "[INFO] å¼€å§‹é…ç½® VNC å¯†ç " "${YELLOW}[+] æ‚¨è¿˜æœªé…ç½® VNC å¯†ç ï¼Œæ‚¨éœ€è¦é…ç½® VNC å¯†ç ...${RESET}"
                    vncpasswd
                    fi
                    # æ£€æŸ¥å·²å®‰è£…çš„æ¡Œé¢ç¯å¢ƒ
                    if [ -f ~/.kali-config/kali-desktop ]; then
                        desktops=($(cat ~/.kali-config/kali-desktop))
                        if [ ${#desktops[@]} -gt 1 ]; then
                            log "[INFO] Multiple desktop environments found" "${CYAN}æ‰¾åˆ°å¤šä¸ªæ¡Œé¢ç¯å¢ƒï¼Œè¯·é€‰æ‹©ä¸€ä¸ªå¼€å§‹${RESET}"
                            for i in "${!desktops[@]}"; do
                                echo -e "${GREEN}[$((i+1))]${RESET} ${desktops[$i]}"
                            done
                            read -p "è¯·è¾“å…¥ä½ çš„é€‰æ‹©: " desktop_choice
                            selected_desktop=${desktops[$((desktop_choice-1))]}
                        else
                            selected_desktop=${desktops[0]}
                        fi
                        log "[INFO] Starting VNC server" "${YELLOW}[+] æ­£åœ¨ä½¿ç”¨ ${selected_desktop} å¯åŠ¨ VNC æœåŠ¡...${RESET}"

                        # å¯åŠ¨é€‰å®šçš„æ¡Œé¢ç¯å¢ƒ
                        case $selected_desktop in
                            "kali-desktop-gnome")
                                startx &
                                ;;
                            "kali-desktop-kde")
                                startplasma-x11 &
                                ;;
                            "kali-desktop-xfce")
                                startxfce4 &
                                ;;
                            "kali-desktop-mate")
                                mate-session &
                                ;;
                            "kali-desktop-lxde")
                                startlxde &
                                ;;
                            "kali-desktop-e17")
                                enlightenment_start &
                                ;;
                            "kali-desktop-i3")
                                i3 &
                                ;;
                            *)
                                log "[ERROR] Unrecognized desktop environment" "${RED}[!] æœªè¯†åˆ«çš„æ¡Œé¢ç¯å¢ƒï¼Œå°è¯•æ‰‹åŠ¨å¯åŠ¨ã€‚${RESET}"
                                ;;
                        esac

                        # å¯åŠ¨VNCæœåŠ¡å™¨å¹¶è·å–è¾“å‡º
                        output=$(vncserver 2>&1)
                        echo "VNC server output:"
                        echo "$output"

                        # æå–æ˜¾ç¤ºç¼–å· (ä¾‹å¦‚ :1)
                        display_number=$(echo "$output" | grep -oP "(?<=:)[0-9]+" | head -n 1)

                        # æ£€æŸ¥æ˜¯å¦æˆåŠŸè·å–æ˜¾ç¤ºç¼–å·å¹¶è®¡ç®—ç«¯å£
                        if [ -n "$display_number" ]; then
                            vnc_port=$((5900 + display_number))
                            echo "VNC æœåŠ¡å™¨å·²è¿è¡Œè‡³: $vnc_port"
                            log "[SUCCESS] Successfully started VNC server" "${GREEN}[+] VNC æœåŠ¡å™¨æˆåŠŸå¯åŠ¨åœ¨ç«¯å£: $vnc_port${RESET}"

                            # å¯åŠ¨ noVNC å’Œ websockify
                            log "[INFO] Starting noVNC server" "${YELLOW}[+] æ­£åœ¨å¯åŠ¨ noVNC æœåŠ¡å™¨...${RESET}"
                            websockify --web=/usr/share/novnc/ 6080 localhost:$vnc_port &
                            if [ $? -eq 0 ]; then
                                log "[SUCCESS] noVNC server started successfully" "${GREEN}[+] noVNC æœåŠ¡å™¨æˆåŠŸå¯åŠ¨åœ¨ç«¯å£ 6080ã€‚${RESET}"
                                echo -e "${YELLOW}ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ URL è¿æ¥åˆ° noVNC æœåŠ¡å™¨:"
                                echo "http://localhost:6080/vnc.html"
                                echo "http://127.0.0.1:6080/vnc.html"
                            else
                                log "[ERROR] Failed to start noVNC server" "${RED}[!] å¯åŠ¨ noVNC æœåŠ¡å™¨å¤±è´¥ã€‚è¯·æ£€æŸ¥é…ç½®å’Œæ—¥å¿—ã€‚${RESET}"
                            fi
                        else
                            echo "æ— æ³•ç¡®å®š VNC æœåŠ¡å™¨ç«¯å£å·ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹æ—¥å¿—ä¿¡æ¯"
                            log "[ERROR] Failed to start VNC server" "${RED}[!] å¯åŠ¨ VNC æœåŠ¡å™¨å¤±è´¥ã€‚æ£€æŸ¥é—®é¢˜...${RESET}"

                            # æ£€æŸ¥ Xorg æ—¥å¿—æ–‡ä»¶ä¸­çš„é”™è¯¯
                            if grep -q "no screens found" /var/log/Xorg.0.log; then
                                log "[ERROR] No screens found" "${RED}[!] æœªæ‰¾åˆ°å±å¹•ã€‚æ‚¨å¯èƒ½éœ€è¦å®‰è£…æˆ–é…ç½®è™šæ‹Ÿæ˜¾ç¤ºå™¨å¦‚ Xvfbã€‚${RESET}"
                            fi
                            log "[INFO] Check log files for more information" "${YELLOW}[i] æ‚¨ä¹Ÿå¯ä»¥åœ¨ /var/log/Xorg.0.log ä¸­æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚${RESET}"
                        fi

                    else
                        log "[ERROR] No desktop environments found" "${RED}[!] æœªæ‰¾åˆ°æ¡Œé¢ç¯å¢ƒï¼Œè¯·å…ˆå®‰è£…ä¸€ä¸ªã€‚${RESET}"
                    fi
                    fi
                    fi
                    ;;

                0)
                    exit 1
                    ;;
                *)
                    log "[WARNING] æ— æ•ˆé€‰æ‹©" "${RED}[!] æ— æ•ˆçš„é€‰æ‹©ï¼Œè¯·é‡è¯•ã€‚${RESET}"
                    ;;
            esac
        done
        break
        elif [[ $choice -eq 4 ]]; then
        break
        exit 1
    else
        log "[WARNING] æ— æ•ˆé€‰æ‹©" "${RED}[!] æ— æ•ˆçš„é€‰æ‹©ï¼Œè¯·é‡è¯•ã€‚${RESET}"
    fi
done
}

# English menu
menu_en(){
vnc-installation(){
if [ -e ~/.vnc/passwd ]; then
IFVNCPASSWD="Is Set"
else
IFVNCPASSWD="Not set"
fi
if [ -e ~/.kali-config/kali-desktop ]; then
Desktop_environment=$(cat ~/.kali-config/kali-desktop)
else
Desktop_environment="No desktop environment yet."
fi
echo -e "\033[1;33m"
headers="VNC Service,Is installed?"
rows=(
    "VNC server,$VNCINSTALL"
    "NOVNC,$VNCINSTALL"
)
python3 /.kali-config/linux/table_gen.py "$headers" "${rows[@]}"

headers="Installed desktop environment."
rows=(
    "$Desktop_environment"
)
python3 /.kali-config/linux/table_gen.py "$headers" "${rows[@]}"

headers="VNC Password"
rows=(
    "$IFVNCPASSWD"
)
python3 /.kali-config/linux/table_gen.py "$headers" "${rows[@]}"
echo -e "\033[0m"
}
Dscription(){
echo -e """
ï¿´ï¿´ï¿´ï¿´ ï¿´ï¿´ ï¿´ï¿´ ï¿´ ï¿´ ï¿´ï¿´ï¿´ ï¿´ï¿´ï¿´ï¿´ ï¿´ï¿´ ï¿´ï¿´ï¿´ï¿´ ï¿´ï¿´ ï¿´ ï¿´ï¿´ï¿´ ï¿´ ï¿´ï¿´â–ƒ â–† â–ˆ
ğ™„ğ™ˆğ™‹ğ™Šğ™ğ™ğ™„ğ˜½ğ™‡ğ™€  ğ™„ğ™ ğ™‰ğ™Šğ™ğ™ƒğ™„ğ™‰ğ™‚
æ²¡æœ‰ä¸å¯èƒ½
\033[0;32m
âŒ: Not compatible with Ankali
â“: Partially compatible with Ankali
âœ…: Fully compatible with Ankali
\033[1;33m
+----------------+-----------------------------------------------------+
| Desktop        | Description and Support                             |
+----------------+-----------------------------------------------------+
| GNOME      âŒ  | A clean, modern desktop environment.                |
| KDE Plasma â“  | Feature-rich, highly customizable.                  |
| XFCE       âœ…  | Lightweight, performance-focused. Fully supported.  |
| MATE       âœ…  | A fork of GNOME 2, offers a traditional experience. |
| LXDE       âœ…  | Very lightweight, ideal for low-end hardware.       |
| E17        âœ…  | Highly customizable, modern visuals                 |
| I3WM       âŒ  | Simple, lightweight, keyboard-driven.               |
+----------------+-----------------------------------------------------+

+------------+----------------+
|  Desktop   | Disk Space (MB)|
+------------+----------------+
| GNOME      |     2,800      |
| KDE Plasma |     4,000      |
| XFCE       |     2,300      |
| MATE       |     2,600      |
| LXDE       |     2,300      |
| E17        |     1,900      |
| I3WM       |     1,900      |
+------------+----------------+
\033[0m
"""
}

IFVNCINSTALL(){
VNCINSTALLIF
if [ "$VNCINSTALL" = "true" ]; then
    VNCINSTALL="Installed"
elif [ "$VNCINSTALL" = "false" ]; then
    VNCINSTALL="Not installed"
else
    VNCINSTALL="unknown"
fi
}
IFNOVNCINSTALL(){
NOVNCINSTALLIF
if [ "$NOVNCINSTALL" = "true" ]; then
    NOVNCINSTALL="Installed"
elif [ "$NOVNCINSTALL" = "false" ]; then
    NOVNCINSTALL="Not installed"
else
    NOVNCINSTALL="unknown"
fi
}

source /.kali-config/language.conf
while true; do
    log "[i] Displaying main menu" "${CYAN}Please choose an option:${RESET}"
    echo -e "${GREEN}[1]${RESET} ${BLUE}Install GUI Graphical Desktop${RESET}"
    echo -e "${GREEN}[2]${RESET} ${BLUE}uninstall GUI Graphical Desktop${RESET}"
    echo -e "${GREEN}[3]${RESET} ${BLUE}VNC Service${RESET}"
    echo -e "${GREEN}[4]${RESET} ${BLUE}Exit${RESET}"
    read -p "Enter your choice: " choice

    if [[ $choice -eq 1 ]]; then
        # GUI Graphical Desktop Menu
        while true; do
            Dscription
            log "[i] User selected option 1: Install GUI Graphical Desktop" "${CYAN}Choose a graphical desktop environment to install:${RESET}"
            echo -e "${GREEN}[1]${RESET} GNOME"
            echo -e "${GREEN}[2]${RESET} KDE Plasma"
            echo -e "${GREEN}[3]${RESET} XFCE"
            echo -e "${GREEN}[4]${RESET} MATE"
            echo -e "${GREEN}[5]${RESET} LXDE"
            echo -e "${GREEN}[6]${RESET} E17 (Enlightenment)"
            echo -e "${GREEN}[7]${RESET} I3WM"
            echo -e "${GREEN}[0]${RESET} Exit"
            read -p "Enter your choice: " gui_choice

            case $gui_choice in
                1)
                    log "[i] Installing GNOME..." "${YELLOW}[+] Installing GNOME...${RESET}"
                    apt install -y kali-desktop-gnome
                    desktop_operate
                    echo "kali-desktop-gnome" >> ~/.kali-config/kali-desktop
                    break
                    ;;
                2)
                    log "[i] Installing KDE Plasma..." "${YELLOW}[+] Installing KDE Plasma...${RESET}"
                    apt install -y kali-desktop-kde
                    desktop_operate
                    echo "kali-desktop-kde" >> ~/.kali-config/kali-desktop
                    break
                    ;;
                3)
                    log "[i] Installing XFCE..." "${YELLOW}[+] Installing XFCE...${RESET}"
                    apt install -y kali-desktop-xfce
                    desktop_operate
                    echo "kali-desktop-xfce" >> ~/.kali-config/kali-desktop
                    break
                    ;;
                4)
                    log "[i] Installing MATE..." "${YELLOW}[+] Installing MATE...${RESET}"
                    apt install -y kali-desktop-mate
                    desktop_operate
                    echo "kali-desktop-mate" >> ~/.kali-config/kali-desktop
                    break
                    ;;
                5)
                    log "[i] Installing LXDE..." "${YELLOW}[+] Installing LXDE...${RESET}"
                    apt install -y kali-desktop-lxde
                    desktop_operate
                    echo "kali-desktop-lxde" >> ~/.kali-config/kali-desktop
                    break
                    ;;
                
                6)
                    log "[INFO] Installing E17" "${YELLOW}[+] Installing E17...${RESET}"
                    apt install -y kali-desktop-e17
                    desktop_operate
                    desktop_time_repair
                    echo "kali-desktop-e17" >> ~/.kali-config/kali-desktop
                    break
                    ;;
                7)
                    log "[INFO] Installing i3wm" "${YELLOW}[+] Installing i3wm...${RESET}"
                    apt install -y kali-desktop-i3
                    desktop_operate
                    desktop_time_repair
                    echo "kali-desktop-i3" >> ~/.kali-config/kali-desktop
                    break
                    ;;
                0)
                    log "[i] User chose to exit from GUI installation menu" "Exiting..."
                    exit 1
                    ;;
                *)
                    log "[!] Invalid choice in GUI menu" "${RED}[!] Invalid choice, please try again.${RESET}"
                    ;;
            esac
        done
        break
    elif [[ $choice -eq 2 ]]; then
    /.kali-config/linux/undesktop
    break
    elif [[ $choice -eq 3 ]]; then
        IFVNCINSTALL
        IFNOVNCINSTALL
        # VNC Service Menu
        while true; do
            vnc-installation
            log "[i] User selected option 2: VNC Service" "${CYAN}Choose a VNC service option:${RESET}"
            echo -e "${GREEN}[1]${RESET} Install VNC Service: $VNCINSTALL"
            echo -e "${GREEN}[2]${RESET} Install NOVNC Service: $NOVNCINSTALL"
            echo -e "${GREEN}[3]${RESET} Configure VNC Password"
            echo -e "${GREEN}[4]${RESET} Start the graphical desktop and VNC service directly"
            echo -e "${GREEN}[5]${RESET} Start VNC + NOVNC services"
            echo -e "${GREEN}[0]${RESET} Exit"
            read -p "Enter your choice: " vnc_choice

            case $vnc_choice in
                1)
                    log "[i] Installing VNC Service..." "${YELLOW}[+] Installing VNC Service...${RESET}"
                    apt install -y tigervnc-standalone-server xinit
                    IFVNCINSTALL
                    ;;
                2)
                    sudo apt update && sudo apt upgrade -y
                    sudo apt install novnc websockify -y
                    IFNOVNCINSTALL
                    ;;
                3)
                    log "[i] Configuring VNC Password..." "${YELLOW}[+] Configuring VNC Password...${RESET}"
                    vncpasswd
                    ;;
                4)
                    if [ "$VNCINSTALL" = "Not installed" ]; then
                    log "[INFO]You have not installed the VNC service yet, you can install it." "${RED}[!] You have not installed the VNC service yet, you can install it."
                    else
                    if [ -e ~/.vnc/passwd ]; then
                    log "The password has been set correctly. Continue to run the desktop."
                    else
                    log "[INFO] Start configuring VNC password" "${YELLOW}[+] You have not configured the VNC password, you need to configure the VNC password....${RESET}"
                    vncpasswd
                    fi
                    # Check installed desktop environments
                    if [ -f ~/.kali-config/kali-desktop ]; then
                        desktops=($(cat ~/.kali-config/kali-desktop))
                        if [ ${#desktops[@]} -gt 1 ]; then
                            log "[INFO] Multiple desktop environments found" "${CYAN}Multiple desktops found, please choose one to start${RESET}"
                            for i in "${!desktops[@]}"; do
                                echo -e "${GREEN}[$((i+1))]${RESET} ${desktops[$i]}"
                            done
                            read -p "Please enter your choice: " desktop_choice
                            selected_desktop=${desktops[$((desktop_choice-1))]}
                        else
                            selected_desktop=${desktops[0]}
                        fi
                        log "[INFO] Starting VNC server" "${YELLOW}[+] Starting VNC server with ${selected_desktop}...${RESET}"

                        # Start the selected desktop environment
                        case $selected_desktop in
                            "kali-desktop-gnome")
                                startx &
                                ;;
                            "kali-desktop-kde")
                                startplasma-x11 &
                                ;;
                            "kali-desktop-xfce")
                                startxfce4 &
                                ;;
                            "kali-desktop-mate")
                                mate-session &
                                ;;
                            "kali-desktop-lxde")
                                startlxde &
                                ;;
                            "kali-desktop-e17")
                                enlightenment_start &
                                ;;
                            "kali-desktop-i3")
                                i3 &
                                ;;
                            *)
                                log "[ERROR] Unrecognized desktop environment" "${RED}[!] Unrecognized desktop environment, trying to start manually.${RESET}"
                                ;;
                        esac

                        # Start VNC server and capture output
                        output=$(vncserver 2>&1)
                        echo "VNC server output:"
                        echo "$output"

                        # Extract display number (e.g., :1)
                        display_number=$(echo "$output" | grep -oP "(?<=:)[0-9]+" | head -n 1)

                        # Check if display number was successfully retrieved and calculate the port
                        if [ -n "$display_number" ]; then
                            vnc_port=$((5900 + display_number))
                            echo "VNC server is running on: $vnc_port"
                            log "[SUCCESS] Successfully started VNC server" "${GREEN}[+] VNC server successfully started on port: $vnc_port${RESET}"
                            echo -e "${YELLOW}You can directly use the following addresses to connect to the VNC server:"
                            echo "127.0.0.1:$vnc_port"
                            echo "localhost:$vnc_port"
                            echo "0.0.0.0:$vnc_port"
                            echo
                            echo -e "${YELLOW}You can also try the following addresses to connect to your VNC server:"
                            ip_addresses=$(hostname -I)
                            for ip in $ip_addresses; do
                            echo "$ip:$vnc_port"
                            done
                        else
                            echo "Unable to determine the VNC server port, please check the log information."
                            log "[ERROR] Failed to start VNC server" "${RED}[!] Failed to start VNC server. Checking for issues...${RESET}"

                            # Check for errors in Xorg log files
                            if grep -q "no screens found" /var/log/Xorg.0.log; then
                                log "[ERROR] No screens found" "${RED}[!] No screens found. You may need to install or configure a virtual display like Xvfb.${RESET}"
                            fi
                            log "[INFO] Check log files for more information" "${YELLOW}[i] You can also check the log files in /var/log/Xorg.0.log for more details.${RESET}"
                        fi

                    else
                        log "[ERROR] No desktop environments found" "${RED}[!] No desktop environments found, please install one first.${RESET}"
                    fi
                    fi
                    ;;
                5)
                    if [ "$NOVNCINSTALL" = "Not installed" ]; then
                    log "[INFO]You have not installed the NOVNC service yet, you can install it." "${RED}[!] You have not installed the NOVNC service yet, you can install it."
                    else
                    if [ "$VNCINSTALL" = "Not installed" ]; then
                    log "[INFO]You have not installed the VNC service yet, you can install it." "${RED}[!] You have not installed the VNC service yet, you can install it."
                    else
                    if [ -e ~/.vnc/passwd ]; then
                    log "The password has been set correctly. Continue to run the desktop."
                    else
                    log "[INFO] Start configuring VNC password" "${YELLOW}[+] You have not configured the VNC password, you need to configure the VNC password....${RESET}"
                    vncpasswd
                    fi
                    # Check installed desktop environments
                    if [ -f ~/.kali-config/kali-desktop ]; then
                        desktops=($(cat ~/.kali-config/kali-desktop))
                        if [ ${#desktops[@]} -gt 1 ]; then
                            log "[INFO] Multiple desktop environments found" "${CYAN}Multiple desktop environments found, please choose one to start.${RESET}"
                            for i in "${!desktops[@]}"; do
                                echo -e "${GREEN}[$((i+1))]${RESET} ${desktops[$i]}"
                            done
                            read -p "Enter your choice: " desktop_choice
                            selected_desktop=${desktops[$((desktop_choice-1))]}
                        else
                            selected_desktop=${desktops[0]}
                        fi
                        log "[INFO] Starting VNC server" "${YELLOW}[+] Starting VNC server using ${selected_desktop}...${RESET}"

                        # Start the selected desktop environment
                        case $selected_desktop in
                            "kali-desktop-gnome")
                                startx &
                                ;;
                            "kali-desktop-kde")
                                startplasma-x11 &
                                ;;
                            "kali-desktop-xfce")
                                startxfce4 &
                                ;;
                            "kali-desktop-mate")
                                mate-session &
                                ;;
                            "kali-desktop-lxde")
                                startlxde &
                                ;;
                            "kali-desktop-e17")
                                enlightenment_start &
                                ;;
                            "kali-desktop-i3")
                                i3 &
                                ;;
                            *)
                                log "[ERROR] Unrecognized desktop environment" "${RED}[!] Unrecognized desktop environment, attempting manual start.${RESET}"
                                ;;
                        esac

                        # Start VNC server and capture the output
                        output=$(vncserver 2>&1)
                        echo "VNC server output:"
                        echo "$output"

                        # Extract display number (e.g., :1)
                        display_number=$(echo "$output" | grep -oP "(?<=:)[0-9]+" | head -n 1)

                        # Check if display number was successfully obtained and calculate port
                        if [ -n "$display_number" ]; then
                            vnc_port=$((5900 + display_number))
                            echo "VNC server is running on port: $vnc_port"
                            log "[SUCCESS] Successfully started VNC server" "${GREEN}[+] VNC server successfully started on port: $vnc_port${RESET}"

                            # Start noVNC and websockify
                            log "[INFO] Starting noVNC server" "${YELLOW}[+] Starting noVNC server...${RESET}"
                            websockify --web=/usr/share/novnc/ 6080 localhost:$vnc_port &
                            if [ $? -eq 0 ]; then
                                log "[SUCCESS] noVNC server started successfully" "${GREEN}[+] noVNC server successfully started on port 6080.${RESET}"
                                echo -e "${YELLOW}You can connect to the noVNC server using the following URLs:"
                                echo "http://localhost:6080/vnc.html"
                                echo "http://127.0.0.1:6080/vnc.html"
                            else
                                log "[ERROR] Failed to start noVNC server" "${RED}[!] Failed to start noVNC server. Please check configuration and logs.${RESET}"
                            fi
                        else
                            echo "Unable to determine VNC server port, please check the log information."
                            log "[ERROR] Failed to start VNC server" "${RED}[!] Failed to start VNC server. Checking for issues...${RESET}"

                            # Check for errors in Xorg log file
                            if grep -q "no screens found" /var/log/Xorg.0.log; then
                                log "[ERROR] No screens found" "${RED}[!] No screens found. You may need to install or configure a virtual display like Xvfb.${RESET}"
                            fi
                            log "[INFO] Check log files for more information" "${YELLOW}[i] You can also check the log file in /var/log/Xorg.0.log for more details.${RESET}"
                        fi

                    else
                        log "[ERROR] No desktop environments found" "${RED}[!] No desktop environments found, please install one first.${RESET}"
                    fi
                    fi
                    fi
                    ;;
                0)
                    log "[i] User chose to exit from VNC Service menu" "Exiting..."
                    exit 1
                    ;;
                *)
                    log "[!] Invalid choice in VNC Service menu" "${RED}[!] Invalid choice, please try again.${RESET}"
                    ;;
            esac
        done
        break
        elif [[ $choice -eq 4 ]]; then
        break
        exit 1
    else
        log "[!] Invalid choice in main menu" "${RED}[!] Invalid choice, please try again.${RESET}"
    fi
done
}

# Judging Chinese or English
CONFIG_FILE="/.kali-config/Ankali.yaml"
# ç¡®ä¿é…ç½®æ–‡ä»¶å­˜åœ¨
if [ ! -f "$CONFIG_FILE" ]; then
    echo -e "${RED}[-] Configuration file does not existï¼š$CONFIG_FILE ${NC}"
    exit 1
fi

# è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å€¼ï¼Œå¿½ç•¥æ³¨é‡Šè¡Œ
get_config_value() {
    local key=$1
    grep "^$key:" "$CONFIG_FILE" | cut -d ' ' -f 2-
}
LANGUAGE=$(get_config_value "LANGUAGE")
if [ "$LANGUAGE" = "CN" ]; then
    menu_cn
elif [ "$LANGUAGE" = "EN" ]; then
    menu_en
else
    menu_en
fi

# Â© Sansjtw Ankali
